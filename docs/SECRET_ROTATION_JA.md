# 露出したシークレットの対処手順（ガイド）

本リポジトリに `.env` が誤ってコミットされた場合の対処方針です。公開履歴に残った値は秘密として扱えません。以下の手順で失効・置換・抹消を進めてください。

## 1. 即時の無効化・ローテーション
- APIキーやパスワードなどのシークレットは、運用環境（シークレットストア/設定）側で直ちに新しい値へローテーションする。
- アプリ側は `.env` またはデプロイ環境変数を更新して再起動する。

## 2. リポジトリからの削除（現行コミット）
- `.gitignore` に `.env` を追加する。
- `.env` をワークツリーから削除（ローカル運用分は各自で保持）。

## 3. 履歴からの抹消（任意・影響大）
公開履歴に含まれる `.env` を完全に削除する場合は履歴書き換えが必要です。フォーク/既存PR/タグに影響します。

### 例（git filter-repo 推奨）
```
pipx install git-filter-repo  # または適切なインストール手段
git filter-repo --invert-paths --path .env
git push --force-with-lease origin main
```

注意: 組織ポリシー上の承認や周知、保護ブランチ設定の調整が必要です。履歴を書き換えた後も、既に取得済みのクローンからはシークレットが復元可能なため、ローテーションは必須です。

## 4. 再発防止
- `.env` を含む機密ファイルを `.gitignore` に追加。
- `configs/env.example` のみをGit管理し、実値はローカル/CIのシークレットストアに置く。
- 必要に応じてプリプッシュフックやCIチェックで `.env` の混入を検知。

