{% extends "base.html" %}
{% block page_header %}
  <h2>Configurations</h2>
  <p>Maintain reusable parameter sets for simulations and planning runs.</p>
{% endblock %}
{% block content %}
<section class="page-section">
  <div class="toolbar gap-bottom-sm">
    <a role="button" href="/ui/configs/new">Create configuration</a>
    <a role="button" class="secondary" href="/ui/runs">Open run history</a>
  </div>
  {% if rows %}
  <div class="table-wrapper">
  <table role="grid">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Updated</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td class="mono">{{ r.id }}</td>
        <td class="mono truncate">{{ r.name }}</td>
        <td class="ts-ms" data-ms="{{ r.updated_at }}">{{ r.updated_at_str or r.updated_at }}</td>
        <td>
          <div class="table-actions">
            <a role="button" href="/ui/configs/{{ r.id }}/edit">Edit</a>
            <form method="post" action="/ui/configs/{{ r.id }}/delete" onsubmit="return confirm('Delete this configuration?');">
              <button type="submit" class="secondary" aria-label="Delete configuration">Delete</button>
            </form>
            <a role="button" class="contrast" href="/?config_id={{ r.id }}" target="_blank" rel="noopener noreferrer">Open simulator</a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
  {% else %}
    <p>No configurations yet. Use “Create configuration” to add one.</p>
  {% endif %}
</section>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    function fmtJst(ms){
      var n = Number(ms);
      if (!Number.isFinite(n)) return '';
      var t = new Date(n + 9*3600*1000); // Shift to JST before formatting
      var y = t.getUTCFullYear();
      var mo = String(t.getUTCMonth()+1).padStart(2,'0');
      var d = String(t.getUTCDate()).padStart(2,'0');
      var h = String(t.getUTCHours()).padStart(2,'0');
      var mi = String(t.getUTCMinutes()).padStart(2,'0');
      var s = String(t.getUTCSeconds()).padStart(2,'0');
      return y + '/' + mo + '/' + d + ' ' + h + ':' + mi + ':' + s;
    }
    document.querySelectorAll('td.ts-ms').forEach(function(td){
      var ms = td.getAttribute('data-ms');
      var txt = fmtJst(ms);
      if (txt) td.textContent = txt;
    });
  })();
  </script>
{% endblock %}
