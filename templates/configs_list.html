{% extends "base.html" %}
{% block page_header %}
  <h2>Configuration Management</h2>
  <p>Lists the versions of the Canonical Configuration shared across the integrated PSI and Planning flow.</p>
{% endblock %}
{% block content %}
<section class="page-section">
  {% if error %}
  <p class="mono warn-text">{{ error }}</p>
  {% endif %}
  <div class="section-header">
    <div>
      <h3>Canonical Configuration Versions</h3>
      <p>Snapshots shared by PSI and Planning pipelines.</p>
    </div>
    <div class="toolbar align-start">
      <form action="/ui/configs/canonical/sample" method="post" class="input-cluster" aria-label="Load sample configuration">
        <label class="sr-only" for="sample-file">Sample file</label>
        <select id="sample-file" name="sample_file">
          {% for sample in sample_files %}
          <option value="{{ sample }}">{{ sample }}</option>
          {% endfor %}
        </select>
        <button type="submit" class="secondary">Load Sample</button>
      </form>
      <a role="button" href="/ui/configs/canonical/import">Import Canonical Configuration</a>
      <a role="button" class="secondary" href="/ui/configs">Refresh</a>
    </div>
  </div>
  <form class="grid-form" method="get" action="/ui/configs/canonical/diff">
    <label>Base version
      <select name="base_id" required>
        <option value="">-- Select --</option>
        {% for opt in diff_options %}
          <option value="{{ opt.id }}">{{ opt.id }} | {{ opt.name }} ({{ opt.status }})</option>
        {% endfor %}
      </select>
    </label>
    <label>Compare to
      <select name="compare_id" required>
        <option value="">-- Select --</option>
        {% for opt in diff_options %}
          <option value="{{ opt.id }}">{{ opt.id }} | {{ opt.name }} ({{ opt.status }})</option>
        {% endfor %}
      </select>
    </label>
    <div class="toolbar align-start">
      <button type="submit">Show Diff</button>
    </div>
  </form>
  {% if canonical_rows %}
  <div class="table-wrapper gap-top-sm">
    <table role="grid">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Status</th>
          <th>Updated (JST)</th>
          <th>Entity Counts</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for row in canonical_rows %}
        <tr>
          <td class="mono">{{ row.meta.version_id }}</td>
          <td class="mono truncate">{{ row.meta.name }}</td>
          <td>{{ row.meta.status }}</td>
          <td class="mono">{{ row.meta.updated_at_str or '-' }}</td>
          <td>
            <small class="mono">
              items={{ row.counts['items']|fmt_number }} / nodes={{ row.counts['nodes']|fmt_number }} /
              arcs={{ row.counts['arcs']|fmt_number }} / bom={{ row.counts['bom']|fmt_number }} /
              demands={{ row.counts['demands']|fmt_number }} / capacities={{ row.counts['capacities']|fmt_number }}
            </small>
          </td>
          <td>
            <div class="table-actions">
              <a role="button" href="/ui/configs/canonical/{{ row.meta.version_id }}">Details</a>
              <a role="button" class="secondary" href="/ui/configs/canonical/{{ row.meta.version_id }}/json">JSON</a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No canonical configuration has been registered yet. Import one to get started.</p>
  {% endif %}
</section>
{% endblock %}
