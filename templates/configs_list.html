{% extends "base.html" %}
{% block page_header %}
  <h2>Configuration Management</h2>
  <p>PSI と Planning の統合フローで共有する Canonical 設定バージョンを一覧します。</p>
{% endblock %}
{% block content %}
<section class="page-section">
  <div class="section-header">
    <div>
      <h3>Canonical Configuration Versions</h3>
      <p>Snapshots shared by PSI and Planning pipelines.</p>
    </div>
    <div class="toolbar">
      <form method="post" action="/ui/configs/canonical/sample" class="inline">
        <button type="submit">Load Sample</button>
      </form>
      <a role="button" href="/ui/configs/canonical/import">Import Canonical Configuration</a>
      <a role="button" class="secondary" href="/ui/configs">Refresh</a>
    </div>
  </div>
  <form class="grid-form" method="get" action="/ui/configs/canonical/diff">
    <label>Base version
      <select name="base_id" required>
        <option value="">-- Select --</option>
        {% for opt in diff_options %}
          <option value="{{ opt.id }}">{{ opt.id }} | {{ opt.name }} ({{ opt.status }})</option>
        {% endfor %}
      </select>
    </label>
    <label>Compare to
      <select name="compare_id" required>
        <option value="">-- Select --</option>
        {% for opt in diff_options %}
          <option value="{{ opt.id }}">{{ opt.id }} | {{ opt.name }} ({{ opt.status }})</option>
        {% endfor %}
      </select>
    </label>
    <div class="toolbar">
      <button type="submit">Show Diff</button>
    </div>
  </form>
  {% if canonical_rows %}
  <div class="table-wrapper gap-top-sm">
    <table role="grid">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Status</th>
          <th>Updated (JST)</th>
          <th>Entity Counts</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for row in canonical_rows %}
        <tr>
          <td class="mono">{{ row.meta.version_id }}</td>
          <td class="mono truncate">{{ row.meta.name }}</td>
          <td>{{ row.meta.status }}</td>
          <td class="mono">{{ row.meta.updated_at_str or '-' }}</td>
          <td>
            <small class="mono">
              items={{ row.counts['items'] }} / nodes={{ row.counts['nodes'] }} /
              arcs={{ row.counts['arcs'] }} / bom={{ row.counts['bom'] }} /
              demands={{ row.counts['demands'] }} / capacities={{ row.counts['capacities'] }}
            </small>
          </td>
          <td>
            <div class="table-actions">
              <a role="button" href="/ui/configs/canonical/{{ row.meta.version_id }}">Details</a>
              <a role="button" class="secondary" href="/ui/configs/canonical/{{ row.meta.version_id }}/json">JSON</a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No canonical configuration has been registered yet. Import one to get started.</p>
  {% endif %}
</section>
{% endblock %}
